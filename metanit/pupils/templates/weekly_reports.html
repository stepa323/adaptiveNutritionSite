{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    .stats-summary {
        cursor: pointer;
        padding: 10px;
        background: var(--darkened-bg);
        color: var(--body-fg);
        border: 1px solid var(--border-color);
    }
    .stats-table {
        width: 100%;
        margin-top: 10px;
        background: var(--body-bg);
        color: var(--body-fg);
    }
    .stats-table th,
    .stats-table td {
        padding: 8px;
        border: 1px solid var(--border-color);
        color: var(--body-fg);
    }
    .stats-table th {
        background: var(--darkened-bg);
    }
    .no-data {
        padding: 10px;
        color: var(--body-quiet-color);
        font-style: italic;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1 style="color: var(--body-fg);">üìä –û—Ç—á–µ—Ç –ø–æ –∑–∞–≤—Ç—Ä–∞–∫–∞–º –∑–∞ –Ω–µ–¥–µ–ª—é</h1>
    <h2 style="color: var(--body-fg);">{{ week_start|date:"d.m" }} - {{ week_end|date:"d.m.Y" }}</h2>

    <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ -->
    <div class="module">
        <form method="get">
            <fieldset class="module aligned">
                <h2 style="color: var(--body-fg);">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –æ—Ç—á–µ—Ç–∞:</h2>
                <div class="form-row">
                    {% for class in all_classes %}
                    <div class="checkbox-row">
                        <label style="color: var(--body-fg);">
                            <input type="checkbox" name="classes" value="{{ class.id }}"
                                   {% if class.id in selected_classes or not selected_classes %}checked{% endif %}>
                            {{ class.name }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </fieldset>
            <div class="submit-row">
                <input type="submit" value="–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç" class="default">
            </div>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü—ã —Å –æ—Ç—á–µ—Ç–∞–º–∏ -->
    {% for class_data in report_data %}
    <div class="module">
        <h2 style="color: var(--body-fg);">–ö–ª–∞—Å—Å: {{ class_data.class.name }}</h2>
        <table style="width: 100%; color: var(--body-fg);">
            <thead>
            <tr>
                <th>–§–∞–º–∏–ª–∏—è</th>
                <th>–ò–º—è</th>
                {% for date in week_dates %}
                <th style="text-align: center;">
                    {{ date|date:"d.m" }}<br>
                    <small>
                        {% if date.weekday == 0 %}–ø–Ω
                        {% endif %}{% if date.weekday == 1 %}–≤—Ç
                        {% endif %}{% if date.weekday == 2 %}—Å—Ä
                        {% endif %}{% if date.weekday == 3 %}—á—Ç
                        {% endif %}{% if date.weekday == 4 %}–ø—Ç
                        {% endif %}
                    </small>
                </th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for pupil_data in class_data.pupils %}
            <tr class="{% cycle 'row1' 'row2' %}">
                <td style="color: var(--body-fg);"><strong>{{ pupil_data.pupil.last_name }}</strong></td>
                <td style="color: var(--body-fg);">{{ pupil_data.pupil.first_name }}</td>
                {% for choice in pupil_data.daily_choices %}
                <td style="text-align: center; color: var(--body-fg);">
                    {% if choice == "‚Äî" %}
                    <span style="color: var(--body-quiet-color);">‚Äî</span>
                    {% else %}
                    {{ choice }}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="module">
        <h2 style="color: var(--body-fg);">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–ª—é–¥–∞–º</h2>

        {% if dish_statistics %}
        {% for day_stats in dish_statistics %}
        <details>
            <summary class="stats-summary">
                {{ day_stats.date|date:"d.m" }} (
                {% if day_stats.date.weekday == 0 %}–ø–Ω
                {% endif %}{% if day_stats.date.weekday == 1 %}–≤—Ç
                {% endif %}{% if day_stats.date.weekday == 2 %}—Å—Ä
                {% endif %}{% if day_stats.date.weekday == 3 %}—á—Ç
                {% endif %}{% if day_stats.date.weekday == 4 %}–ø—Ç
                {% endif %})
            </summary>
            {% if day_stats.stats and day_stats.stats|length > 0 %}
            <table class="stats-table">
                <thead>
                <tr>
                    <th>–ë–ª—é–¥–æ</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π</th>
                </tr>
                </thead>
                <tbody>
                {% for dish in day_stats.stats %}
                <tr>
                    <td>{{ dish.chosen_dish__name }}</td>
                    <td>{{ dish.total }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</p>
            {% endif %}
        </details>
        {% endfor %}
        {% else %}
        <p class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
        {% endif %}
    </div>
</div>
{% endblock %}